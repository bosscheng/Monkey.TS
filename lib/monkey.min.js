var __extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),MF_EVENT;!function(t){var e=function(){function t(t,e){void 0===e&&(e=null),this.type=t,this.data=e}return t}();t.Event=e}(MF_EVENT||(MF_EVENT={}));var MF_EVENT;!function(t){var e=function(){function t(){this.eventLip={}}return t.prototype.onEvent=function(t,e){this.addEventListener(t,e)},t.prototype.moveEvent=function(t,e){this.removeEventListener(t,e)},t.prototype.addEventListener=function(t,e){this.eventLip[t]||(this.eventLip[t]=new Array),this.contains(t,e)||this.eventLip[t].push(e)},t.prototype.dispatchEvent=function(t){var e=this.eventLip[t.type];if(e)for(var n=0;n<e.length;n++){var i=e[n];t.target=this,i(t)}},t.prototype.contains=function(t,e){for(var n=0;n<this.eventLip[t].length;n++)if(this.eventLip[t][n]==e)return!0;return!1},t.prototype.removeEventListener=function(t,e){var n=this.eventLip[t];if(n)for(var i=0;i<n.length;i++)n[i]==e&&n.splice(i)},t}();t.EventDispatcher=e}(MF_EVENT||(MF_EVENT={}));var MF_Point=function(){function t(t,e,n,i,a,o,r){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),void 0===i&&(i=0),void 0===a&&(a=0),void 0===o&&(o=0),void 0===r&&(r=0),this.x=t,this.y=e,this.angle=i,this.offsetdistance=r,this.offsetx=a,this.offsety=o}return t}(),EventDispatcher=MF_EVENT.EventDispatcher,MF_VFILE=function(t){function e(){var e=t.call(this)||this;return window.hasOwnProperty("File")&&window.hasOwnProperty("FileReader")&&window.hasOwnProperty("FileList")&&window.hasOwnProperty("Blob")?(console.log("Great success! All the File APIs are supported."),e.file=new FileReader,e.file.onload=function(t){e.dispatchEvent(new MF_EVENT.Event("fileloaded",t.target.result)),e.initInput()},e.initInput(),e):(console.log("The File APIs are not fully supported in this browser."),alert("你使用的浏览器不支持文件本地上传。请更新你的浏览器"),e)}return __extends(e,t),e.prototype.initInput=function(){var t=this;this.input=null,this.input=document.createElement("input"),this.input.type="file",this.input.onchange=function(e){t.fileSelect(e)}},e.getInstance=function(){return e.instance||(e.instance=new e),e.instance},e.prototype.fileSelect=function(t){var e=(t.target||window.event.srcElement,this.input.files[0]);return e?(this.file.readAsDataURL(e),void console.log("载入VFILE资源")):(console.log("没有选择文件"),void this.dispatchEvent(new MF_EVENT.Event("error","null")))},e.prototype.loadFile=function(t){if(t&&(this.input.accept=t),document.all)this.input.click();else{var e=document.createEvent("MouseEvents");e.initEvent("click",!0,!0),this.input.dispatchEvent(e)}},e}(MF_EVENT.EventDispatcher),MF_COVERIMG=function(){function t(){}return t.coverBack90=function(t,e){var n=t.width,i=t.height,a=document.createElement("canvas");a.style.width=i+"px",a.style.height=n+"px",a.setAttribute("width",i),a.setAttribute("height",n);var o=a.getContext("2d");o.translate(i,0),o.rotate(.5*Math.PI),o.drawImage(t,0,0,n,i,0,0,n,i);var r=new Image;r.onload=function(){a=null,o=null,e(r)},r.src=a.toDataURL("image/jpg")},t.coverBack180=function(t,e){var n=t.width,i=t.height,a=document.createElement("canvas");a.style.width=n+"px",a.style.height=i+"px",a.setAttribute("width",n),a.setAttribute("height",i);var o=a.getContext("2d");o.translate(n,i),o.rotate(-1*Math.PI),o.drawImage(t,0,0,n,i,0,0,n,i);var r=new Image;r.onload=function(){a=null,o=null,e(r)},r.src=a.toDataURL("image/jpg")},t}();(function(){function t(t){return!!t.exifdata}function e(t,e){e=e||t.match(/^data\:([^\;]+)\;base64,/im)[1]||"",t=t.replace(/^data\:([^\;]+)\;base64,/gim,"");for(var n=atob(t),i=n.length,a=new ArrayBuffer(i),o=new Uint8Array(a),r=0;i>r;r++)o[r]=n.charCodeAt(r);return a}function i(t,e){var n=new XMLHttpRequest;n.open("GET",t,!0),n.responseType="blob",n.onload=function(t){200!=this.status&&0!==this.status||e(this.response)},n.send()}function a(t,n){function a(e){var i=o(e),a=r(e);t.exifdata=i||{},t.iptcdata=a||{},n&&n.call(t)}if(t.src)if(/^data\:/i.test(t.src)){var s=e(t.src);a(s)}else if(/^blob\:/i.test(t.src)){var c=new FileReader;c.onload=function(t){a(t.target.result)},i(t.src,function(t){c.readAsArrayBuffer(t)})}else{var h=new XMLHttpRequest;h.onload=function(){if(200!=this.status&&0!==this.status)throw"Could not load image";a(h.response),h=null},h.open("GET",t.src,!0),h.responseType="arraybuffer",h.send(null)}else if(window.FileReader&&(t instanceof window.Blob||t instanceof window.File)){var c=new FileReader;c.onload=function(t){p&&console.log("Got file of length "+t.target.result.byteLength),a(t.target.result)},c.readAsArrayBuffer(t)}}function o(t){var e=new DataView(t);if(p&&console.log("Got file of length "+t.byteLength),255!=e.getUint8(0)||216!=e.getUint8(1))return p&&console.log("Not a valid JPEG"),!1;for(var n,i=2,a=t.byteLength;a>i;){if(255!=e.getUint8(i))return p&&console.log("Not a valid marker at offset "+i+", found: "+e.getUint8(i)),!1;if(n=e.getUint8(i+1),p&&console.log(n),225==n)return p&&console.log("Found 0xFFE1 marker"),l(e,i+4,e.getUint16(i+2)-2);i+=2+e.getUint16(i+2)}}function r(t){var e=new DataView(t);if(p&&console.log("Got file of length "+t.byteLength),255!=e.getUint8(0)||216!=e.getUint8(1))return p&&console.log("Not a valid JPEG"),!1;for(var n=2,i=t.byteLength,a=function(t,e){return 56===t.getUint8(e)&&66===t.getUint8(e+1)&&73===t.getUint8(e+2)&&77===t.getUint8(e+3)&&4===t.getUint8(e+4)&&4===t.getUint8(e+5)};i>n;){if(a(e,n)){var o=e.getUint8(n+7);o%2!==0&&(o+=1),0===o&&(o=4);var r=n+8+o,c=e.getUint16(n+6+o);return s(t,r,c)}n++}}function s(t,e,n){for(var i,a,o,r,s,c=new DataView(t),h={},l=e;e+n>l;)28===c.getUint8(l)&&2===c.getUint8(l+1)&&(r=c.getUint8(l+2),r in E&&(o=c.getInt16(l+3),s=o+5,a=E[r],i=u(c,l+5,o),h.hasOwnProperty(a)?h[a]instanceof Array?h[a].push(i):h[a]=[h[a],i]:h[a]=i)),l++;return h}function c(t,e,n,i,a){var o,r,s,c=t.getUint16(n,!a),u={};for(s=0;c>s;s++)o=n+12*s+2,r=i[t.getUint16(o,!a)],!r&&p&&console.log("Unknown tag: "+t.getUint16(o,!a)),u[r]=h(t,o,e,n,a);return u}function h(t,e,n,i,a){var o,r,s,c,h,l,p=t.getUint16(e+2,!a),d=t.getUint32(e+4,!a),f=t.getUint32(e+8,!a)+n;switch(p){case 1:case 7:if(1==d)return t.getUint8(e+8,!a);for(o=d>4?f:e+8,r=[],c=0;d>c;c++)r[c]=t.getUint8(o+c);return r;case 2:return o=d>4?f:e+8,u(t,o,d-1);case 3:if(1==d)return t.getUint16(e+8,!a);for(o=d>2?f:e+8,r=[],c=0;d>c;c++)r[c]=t.getUint16(o+2*c,!a);return r;case 4:if(1==d)return t.getUint32(e+8,!a);for(r=[],c=0;d>c;c++)r[c]=t.getUint32(f+4*c,!a);return r;case 5:if(1==d)return h=t.getUint32(f,!a),l=t.getUint32(f+4,!a),s=new Number(h/l),s.numerator=h,s.denominator=l,s;for(r=[],c=0;d>c;c++)h=t.getUint32(f+8*c,!a),l=t.getUint32(f+4+8*c,!a),r[c]=new Number(h/l),r[c].numerator=h,r[c].denominator=l;return r;case 9:if(1==d)return t.getInt32(e+8,!a);for(r=[],c=0;d>c;c++)r[c]=t.getInt32(f+4*c,!a);return r;case 10:if(1==d)return t.getInt32(f,!a)/t.getInt32(f+4,!a);for(r=[],c=0;d>c;c++)r[c]=t.getInt32(f+8*c,!a)/t.getInt32(f+4+8*c,!a);return r}}function u(t,e,i){var a="";for(n=e;n<e+i;n++)a+=String.fromCharCode(t.getUint8(n));return a}function l(t,e){if("Exif"!=u(t,e,4))return p&&console.log("Not valid EXIF data! "+u(t,e,4)),!1;var n,i,a,o,r,s=e+6;if(18761==t.getUint16(s))n=!1;else{if(19789!=t.getUint16(s))return p&&console.log("Not valid TIFF data! (no 0x4949 or 0x4D4D)"),!1;n=!0}if(42!=t.getUint16(s+2,!n))return p&&console.log("Not valid TIFF data! (no 0x002A)"),!1;var h=t.getUint32(s+4,!n);if(8>h)return p&&console.log("Not valid TIFF data! (First offset less than 8)",t.getUint32(s+4,!n)),!1;if(i=c(t,s,s+h,m,n),i.ExifIFDPointer){o=c(t,s,s+i.ExifIFDPointer,g,n);for(a in o){switch(a){case"LightSource":case"Flash":case"MeteringMode":case"ExposureProgram":case"SensingMethod":case"SceneCaptureType":case"SceneType":case"CustomRendered":case"WhiteBalance":case"GainControl":case"Contrast":case"Saturation":case"Sharpness":case"SubjectDistanceRange":case"FileSource":o[a]=y[a][o[a]];break;case"ExifVersion":case"FlashpixVersion":o[a]=String.fromCharCode(o[a][0],o[a][1],o[a][2],o[a][3]);break;case"ComponentsConfiguration":o[a]=y.Components[o[a][0]]+y.Components[o[a][1]]+y.Components[o[a][2]]+y.Components[o[a][3]]}i[a]=o[a]}}if(i.GPSInfoIFDPointer){r=c(t,s,s+i.GPSInfoIFDPointer,v,n);for(a in r){switch(a){case"GPSVersionID":r[a]=r[a][0]+"."+r[a][1]+"."+r[a][2]+"."+r[a][3]}i[a]=r[a]}}return i}var p=!1,d=this,f=function(t){return t instanceof f?t:this instanceof f?void(this.EXIFwrapped=t):new f(t)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=f),exports.EXIF=f):d.EXIF=f;var g=f.Tags={36864:"ExifVersion",40960:"FlashpixVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",37121:"ComponentsConfiguration",37122:"CompressedBitsPerPixel",37500:"MakerNote",37510:"UserComment",40964:"RelatedSoundFile",36867:"DateTimeOriginal",36868:"DateTimeDigitized",37520:"SubsecTime",37521:"SubsecTimeOriginal",37522:"SubsecTimeDigitized",33434:"ExposureTime",33437:"FNumber",34850:"ExposureProgram",34852:"SpectralSensitivity",34855:"ISOSpeedRatings",34856:"OECF",37377:"ShutterSpeedValue",37378:"ApertureValue",37379:"BrightnessValue",37380:"ExposureBias",37381:"MaxApertureValue",37382:"SubjectDistance",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37396:"SubjectArea",37386:"FocalLength",41483:"FlashEnergy",41484:"SpatialFrequencyResponse",41486:"FocalPlaneXResolution",41487:"FocalPlaneYResolution",41488:"FocalPlaneResolutionUnit",41492:"SubjectLocation",41493:"ExposureIndex",41495:"SensingMethod",41728:"FileSource",41729:"SceneType",41730:"CFAPattern",41985:"CustomRendered",41986:"ExposureMode",41987:"WhiteBalance",41988:"DigitalZoomRation",41989:"FocalLengthIn35mmFilm",41990:"SceneCaptureType",41991:"GainControl",41992:"Contrast",41993:"Saturation",41994:"Sharpness",41995:"DeviceSettingDescription",41996:"SubjectDistanceRange",40965:"InteroperabilityIFDPointer",42016:"ImageUniqueID"},m=f.TiffTags={256:"ImageWidth",257:"ImageHeight",34665:"ExifIFDPointer",34853:"GPSInfoIFDPointer",40965:"InteroperabilityIFDPointer",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",274:"Orientation",277:"SamplesPerPixel",284:"PlanarConfiguration",530:"YCbCrSubSampling",531:"YCbCrPositioning",282:"XResolution",283:"YResolution",296:"ResolutionUnit",273:"StripOffsets",278:"RowsPerStrip",279:"StripByteCounts",513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength",301:"TransferFunction",318:"WhitePoint",319:"PrimaryChromaticities",529:"YCbCrCoefficients",532:"ReferenceBlackWhite",306:"DateTime",270:"ImageDescription",271:"Make",272:"Model",305:"Software",315:"Artist",33432:"Copyright"},v=f.GPSTags={0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude",5:"GPSAltitudeRef",6:"GPSAltitude",7:"GPSTimeStamp",8:"GPSSatellites",9:"GPSStatus",10:"GPSMeasureMode",11:"GPSDOP",12:"GPSSpeedRef",13:"GPSSpeed",14:"GPSTrackRef",15:"GPSTrack",16:"GPSImgDirectionRef",17:"GPSImgDirection",18:"GPSMapDatum",19:"GPSDestLatitudeRef",20:"GPSDestLatitude",21:"GPSDestLongitudeRef",22:"GPSDestLongitude",23:"GPSDestBearingRef",24:"GPSDestBearing",25:"GPSDestDistanceRef",26:"GPSDestDistance",27:"GPSProcessingMethod",28:"GPSAreaInformation",29:"GPSDateStamp",30:"GPSDifferential"},y=f.StringValues={ExposureProgram:{0:"Not defined",1:"Manual",2:"Normal program",3:"Aperture priority",4:"Shutter priority",5:"Creative program",6:"Action program",7:"Portrait mode",8:"Landscape mode"},MeteringMode:{0:"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"},LightSource:{0:"Unknown",1:"Daylight",2:"Fluorescent",3:"Tungsten (incandescent light)",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 - 5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"},Flash:{0:"Flash did not fire",1:"Flash fired",5:"Strobe return light not detected",7:"Strobe return light detected",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"},SensingMethod:{1:"Not defined",2:"One-chip color area sensor",3:"Two-chip color area sensor",4:"Three-chip color area sensor",5:"Color sequential area sensor",7:"Trilinear sensor",8:"Color sequential linear sensor"},SceneCaptureType:{0:"Standard",1:"Landscape",2:"Portrait",3:"Night scene"},SceneType:{1:"Directly photographed"},CustomRendered:{0:"Normal process",1:"Custom process"},WhiteBalance:{0:"Auto white balance",1:"Manual white balance"},GainControl:{0:"None",1:"Low gain up",2:"High gain up",3:"Low gain down",4:"High gain down"},Contrast:{0:"Normal",1:"Soft",2:"Hard"},Saturation:{0:"Normal",1:"Low saturation",2:"High saturation"},Sharpness:{0:"Normal",1:"Soft",2:"Hard"},SubjectDistanceRange:{0:"Unknown",1:"Macro",2:"Close view",3:"Distant view"},FileSource:{3:"DSC"},Components:{0:"",1:"Y",2:"Cb",3:"Cr",4:"R",5:"G",6:"B"}},E={120:"caption",110:"credit",25:"keywords",55:"dateCreated",80:"byline",85:"bylineTitle",122:"captionWriter",105:"headline",116:"copyright",15:"category"};f.getData=function(e,n){return(e instanceof Image||e instanceof HTMLImageElement)&&!e.complete?!1:(t(e)?n&&n.call(e):a(e,n),!0)},f.getTag=function(e,n){return t(e)?e.exifdata[n]:void 0},f.getAllTags=function(e){if(!t(e))return{};var n,i=e.exifdata,a={};for(n in i)i.hasOwnProperty(n)&&(a[n]=i[n]);return a},f.pretty=function(e){if(!t(e))return"";var n,i=e.exifdata,a="";for(n in i)i.hasOwnProperty(n)&&(a+="object"==typeof i[n]?i[n]instanceof Number?n+" : "+i[n]+" ["+i[n].numerator+"/"+i[n].denominator+"]\r\n":n+" : ["+i[n].length+" values]\r\n":n+" : "+i[n]+"\r\n");return a},f.readFromBinaryFile=function(t){return o(t)},"function"==typeof define&&define.amd&&define("exif-js",[],function(){return f})}).call(this);var MF_Canvas=function(t){function e(){var e=t.call(this)||this;return e._scale=1,e.offsetscale=0,e._x=0,e._y=0,e.offsetx=0,e.offsety=0,e._rotate=0,e.offsetrotate=0,e.imgPosition={},e.layers=[],e.fillStyle="normal",e.canvas=document.createElement("canvas"),e.context=e.canvas.getContext("2d"),e}return __extends(e,t),e.prototype.getStyle=function(t){return this.myCanvas.style[t]},e.prototype.draw=function(t){this.imgdate=t;var e=this;EXIF&&EXIF.getData(this.imgdate,function(){var t=EXIF.getAllTags(this);e.reCoverData(t)})},e.prototype.reCoverData=function(t){var e=this;switch(console.log(t),t.Orientation){case 1:this.doDraw();break;case 6:MF_COVERIMG.coverBack90(this.imgdate,function(t){e.doDraw(t)});break;case 8:this.doDraw();break;case 3:MF_COVERIMG.coverBack180(this.imgdate,function(t){e.doDraw(t)});break;default:this.doDraw()}},e.prototype.doDraw=function(t){void 0===t&&(t=null),t&&(this.imgdate=t);var e=this.imgdate,n=e.width,i=e.height,a=this.canvas.width,o=this.canvas.height;switch(this.imgPosition.width=a,this.imgPosition.height=o,this.context.setTransform(1,0,0,1,0,0),this.context.save(),this._x=this._y=this._rotate=0,this._scale=1,this.fillStyle){case"normal":if(n/i>a/o){this.imgw=a;var r=a/n;this.imgh=i*r,this.y=(o-this.imgh)/2}else{this.imgh=o;var r=o/i;this.imgw=n*r,this.x=(a-this.imgw)/2}break;case"cover":if(n/i>a/o){this.imgh=o;var r=o/i;this.imgw=n*r,this.x=(a-this.imgw)/2}else{this.imgw=a;var r=a/n;this.imgh=i*r,this.y=(o-this.imgh)/2}}this.dispatchEvent(new MF_EVENT.Event("drawcomplete"))},e.prototype.update=function(){var t=this.imgdate;if(t){var e=t.width,n=t.height;this.canvas.width,this.canvas.height;this.clear(),this.context.globalCompositeOperation="copy";var i=this.canvas.width/2,a=this.canvas.height/2;this.context.translate(i,a),this.context.translate(this.x,this.y),this.context.rotate(this._rotate/180*Math.PI),this.context.scale(this._scale,this._scale),this.context.translate(-i,-a),this.context.drawImage(t,0,0,e,n,0,0,this.imgw,this.imgh),this.offsetrotate=this.offsetscale=this.offsetx=this.offsety=0,this.context.restore();for(var o=0;o<this.layers.length;o++){var r=this.layers[o];this.drawLayer(r)}}},e.prototype.addLayer=function(t){this.layers.push(t)},e.prototype.drawLayer=function(t){this.context.drawImage(t.img,0,0,t.img.width,t.img.height,t.posx,t.posy,t.img.width,t.img.height)},e.prototype.clear=function(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height)},Object.defineProperty(e.prototype,"scale",{get:function(){return this._scale},set:function(t){this.offsetscale=t-this._scale,this._scale=t,this.context.save(),this.update()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"x",{get:function(){return this._x},set:function(t){this.offsetx=t-this._x,this.offsetx=t,this._x=t,this.context.save(),this.update()},enumerable:!0,configurable:!0}),e.prototype.roateAnglePosition=function(t,e,n){t+=this.canvas.width/2,e+=this.canvas.height/2;var i=Math.cos(n)*t-Math.sin(n)*e,a=Math.cos(n)*e+Math.sin(n)*t;return{ofx:i,ofy:a}},Object.defineProperty(e.prototype,"y",{get:function(){return this._y},set:function(t){this.offsety=t-this._y,this.offsety=t,this._y=t;this.roateAnglePosition(0,this.offsety/this._scale,-this.rotation/180*Math.PI);this.context.save(),this.update()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rotation",{get:function(){return this._rotate},set:function(t){this.offsetrotate=(t-this._rotate)/180*Math.PI,this._rotate=t,this.context.save(),this.update()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"myCanvas",{get:function(){return this.canvas},enumerable:!0,configurable:!0}),e.prototype.setStyle=function(t,e){if(this.canvas.style[t]=e,"width"==t){var n=parseFloat(e.replace("px",""));this.canvas.width=n}if("height"==t){var i=parseFloat(e.replace("px",""));this.canvas.height=i}},e.prototype.getCanvasData=function(t,e){return void 0===e&&(e=1),this.canvas.toDataURL(t,e)},e.canvasLabs={},e}(MF_EVENT.EventDispatcher),canvasLayerOption=function(){function t(t,e,n,i){void 0===n&&(n=0),void 0===i&&(i=0);var a=this;this._img=e,this._canvas=t,this._canvas.addLayer(this),this.position=new MF_Point(n,i),e.onload?this.onImgLoaded():e.onload=function(t){a.onImgLoaded()}}return Object.defineProperty(t.prototype,"posx",{get:function(){return this.position.x},set:function(t){this.position.x=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"posy",{get:function(){return this.position.y},set:function(t){this.position.y=t},enumerable:!0,configurable:!0}),t.prototype.onImgLoaded=function(){this._canvas.drawLayer(this)},Object.defineProperty(t.prototype,"img",{get:function(){return this._img},enumerable:!0,configurable:!0}),t}(),MF_animateImages=function(t){function e(e){void 0===e&&(e=null);var n=t.call(this)||this;return n.ITV=null,n.startIndex=0,n.progress=0,n.up=null,n.rmsPrefix=/^-ms-/,n.rdashAlpha=/-([\da-z])/gi,n.cssPrefixes=["Webkit","O","Moz","ms"],n.parameter.imgList.length>0&&(n.width=n.parameter.width?n.parameter.width:n.parameter.imgList[0].width,n.height=n.parameter.height?n.parameter.height:n.parameter.imgList[0].height),MF_display_Judger.isDom(n.parameter.parents)?n.parents=n.parameter.parents:MF_display_Judger.isJQ(n.parameter.parents)&&(n.parents=n.parameter.parents[0]),n.anmtList=n.parameter.imgList,n.type=n.parameter.type?n.parameter.type:"canvas",n.step=n.parameter.step||1,n.times=n.parameter.times||100,n.loop=n.parameter.loop||!1,n}return __extends(e,t),e.prototype.drawImages=function(t){},e.prototype.clear=function(){},e.prototype.getPosition=function(t){},e.prototype.fcamelCase=function(t,e){return e.toUpperCase()},e.prototype.camelCase=function(t){return t.replace(this.rmsPrefix,"ms-").replace(this.rdashAlpha,this.fcamelCase)},e.prototype.vendorPropName=function(t,e){if(e in t)return e;for(var n=e.charAt(0).toUpperCase()+e.slice(1),i=e,a=this.cssPrefixes.length;a--;)if(e=this.cssPrefixes[a]+n,e in t)return e;return i},e.prototype.setOp=function(t,e){t.runtimeStyle?"undefined"==typeof t.runtimeStyle.opacity?t.style.filter="alpha(opacity="+100*e+")":t.runtimeStyle.opacity=e:t.style.opacity=e},e.prototype.toProgress=function(t){this.progress=t,this.drawImages(t)},e.prototype.setStart=function(t){this.startIndex=t,this.toProgress(t)},e.prototype.setEnd=function(t){t>this.length?this.endIndex=this.length:this.endIndex=t},e.prototype.play=function(){var t=this;t.ITV=setInterval(function(){if(t.progress+=t.step,t.progress>=t.endIndex){if(!t.loop)return t.stop(),void t.dispatchEvent(new MF_EVENT.Event("complete",t.progress));t.progress=t.startIndex}t.toProgress(t.progress),t.dispatchEvent(new MF_EVENT.Event("update",t.progress)),t.dispatchEvent(new MF_EVENT.Event(t.progress,t.progress))},t.times)},e.prototype.stopActivity=function(){this.ITV&&(clearInterval(this.ITV),this.ITV=null)},e.prototype.pause=function(){this.stopActivity()},e.prototype.stop=function(){this.stopActivity(),this.progress=this.startIndex},e.prototype.creatElment=function(t){return document.createElement(t)},e.prototype.setCssObj=function(t,e){for(name in e)this.css(t,name,e[name])},e.prototype.css=function(t,e,n){if("undefined"==typeof e||!e)return!1;if("object"==typeof e)return this.setCssObj(t,e),!1;var i=this.camelCase(e),a=t.style,o=this.vendorPropName(a,i);return"opacity"==o?void this.setOp(t,n):"undefined"==typeof n?""!=t.style[o]?t.style[o]:window.getComputedStyle?window.getComputedStyle(t,null)[o]:t.currentStyle?t.currentStyle[o]:"auto":void(t.runtimeStyle?t.runtimeStyle[o]=n:t.style[o]=n)},e.prototype.remove=function(){for(;this.parents.hasChildNodes();)this.parents.removeChild(this.parents.firstChild)},e}(MF_EVENT.EventDispatcher),MF_display_Judger=function(){function t(){}return t.isAndroid=function(){return/(Android)/i.test(navigator.userAgent)},t.isDom=function(t){return"object"==typeof t&&t instanceof HTMLElement},t.isJQ=function(t){return"object"==typeof t&&t instanceof jQuery},t.isLdDom=function(t){if("object"==typeof t&&t instanceof HTMLElement){var e=t.nodeName.toLowerCase();if("img"==e||"video"==e||"audio"==e)return!0}return!1},t.isLdCompleteList=function(t){if("object"==typeof t&&"sort"in t){var e=t[0];if("src"in e&&"e"in e)return!0}return!1},t.getDomType=function(t){return t.nodeName.toLowerCase()},t.getImgList=function(t){var e=new Array;for(var n in t){var i=t[n];"src"in i&&"e"in i&&e.push(i.e)}return e},t}(),MF_animateSheet=function(t){function e(e){var n=this;return n.parameter=e,MF_display_Judger.isLdCompleteList(n.parameter.imgList)?n.parameter.imgList=MF_display_Judger.getImgList(n.parameter.imgList):n.parameter.imgList=[],n=t.call(this,n.parameter)||this,n.length=n.parameter.imgList.length,"canvas"==n.type?(n.canvas=n.creatElment("canvas"),n.canvas.width=n.width,n.canvas.height=n.height,n.parents.appendChild(n.canvas)):"img"==n.type,n.endIndex=n.length,n.toProgress(n.progress),n}return __extends(e,t),e.prototype.drawImages=function(t){switch(this.type){case"img":this.clear(),this.parents.appendChild(this.anmtList[t]);break;case"canvas":var e=this.canvas.getContext("2d");this.clear();var n=this.anmtList[t];e.drawImage(n,0,0)}},e.prototype.clear=function(){switch(this.type){case"img":for(;this.parents.hasChildNodes();)this.parents.removeChild(this.parents.firstChild);break;case"canvas":var t=this.canvas.getContext("2d");t.clearRect(0,0,this.width,this.height)}},e}(MF_animateImages),MF_animateSprite=function(t){function e(e){var n=this;n.parameter=e,MF_display_Judger.isDom(n.parameter.imgList)?n.parameter.imgList=[n.parameter.imgList]:MF_display_Judger.isLdCompleteList(n.parameter.imgList)?n.parameter.imgList=MF_display_Judger.getImgList(n.parameter.imgList):MF_display_Judger.isJQ(n.parameter.imgList)||(n.parameter.imgList=[]),n=t.call(this,e)||this,n.length=n.parameter.row*n.parameter.column;var i=n.anmtList[0];if(n.getPosition=function(t){return{x:-(t%this.parameter.column*this.width),y:-(parseInt(t/this.parameter.column)*this.height)}},"canvas"==n.type){n.remove(),n.canvas=n.creatElment("canvas"),n.canvas.width=n.width,n.canvas.height=n.height,n.parents.appendChild(n.canvas);var a=n.canvas.getContext("2d"),o=i.width,r=i.height;n.drawImages=function(t){this.clear();var e=this.getPosition(t);a.drawImage(i,e.x,e.y,o,r)},n.clear=function(){a.clearRect(0,0,this.width,this.height)}}else if("img"==n.type){var s=n.creatElment("div");n.css(s,{position:"absolute",top:0,left:0,width:n.width+"px",height:n.height+"px",overflow:"hidden"},null),n.parents.appendChild(s),s.appendChild(i),n.css(i,{position:"absolute",top:0,left:0},null),n.drawImages=function(t){var e=this.getPosition(t);this.css(i,{top:e.y+"px",left:e.x+"px"},null)},n.clear=function(){for(;this.parents.hasChildNodes();)this.parents.removeChild(this.parents.firstChild)}}return n.endIndex=n.length,n.toProgress(n.progress),n}return __extends(e,t),e}(MF_animateImages),MF_UTILS=function(){function t(){}return t.setCookie=function(t,e,n){void 0===n&&(n=6e4);var n=n||6e4,i=new Date;i.setTime(i.getTime()+n),document.cookie=t+"="+encodeURI(e)+";expires="+i.toUTCString()},t.getCookie=function(t){var e,n=new RegExp("(^| )"+t+"=([^;]*)(;|$)");return(e=document.cookie.match(n))?decodeURI(e[2]):null},t.removeCookie=function(e){t.setCookie(e,"",-1e3)},t.getQuest=function(t){var e=new RegExp("(^|&)"+t+"=([^&]*)(&|$)","i"),n=window.location.search.substr(1).match(e);return null!=n?n[2]:null},t.isTel=function(t){return/^1[3|4|5|8] \d{9}$/.test(t)},t.discribeObject=function(t,e){void 0===e&&(e="");var n="";e||(e="");for(var i in t)if(n+=e+i+":",t[i]instanceof Array)n+="[",n+=t[i],n+="]\n";else if(t[i]instanceof Object){var a=e+"  ";n+="{\n",n+=this.discribeObject(t[i],a),n+=a+"}\n"}else n+=t[i]+"\n";return n},t.html_decode=function(t){var e="";return 0==t.length?"":(e=t.replace(/&gt;/g,"&"),e=e.replace(/&lt;/g,"<"),e=e.replace(/&gt;/g,">"),e=e.replace(/&nbsp;/g," "),e=e.replace(/&#39;/g,"'"),e=e.replace(/&quot;/g,'"'),e=e.replace(/<br>/g,"\n"))},t.catact=function(t,e){for(var n in e)"Object"==typeof e[n]?arguments.callee(t[n],e[n]):t[n]=e[n];return t},t.getStyleWidth=function(t){var e=t.style.width;return e},t.getStyleHeight=function(t){var e=t.style.height;return e},t.getStyleTop=function(t){var e=t.style.top;return e},t.getStyleLeft=function(t){var e=t.style.left;return e},t}(),MF_ImageScroller=function(t){function e(e,n,i){var a=t.call(this)||this;return"string"==typeof e?a.box=document.getElementById(e):e.tagName&&(a.box=e),a.mf_canvas=new MF_Canvas,a.mf_canvas.setStyle("width",n+"px"),a.mf_canvas.setStyle("height",i+"px"),a.box.appendChild(a.mf_canvas.myCanvas),MF_VFILE.getInstance().addEventListener("fileloaded",function(t){a.handleFileLoaded(t)}),a.mf_canvas.addEventListener("drawcomplete",function(t){a.dispatchEvent(new MF_EVENT.Event("drawcomplete"))}),a}return __extends(e,t),Object.defineProperty(e.prototype,"CanvasFilleStyle",{set:function(t){this.mf_canvas.fillStyle=t||"normal"},enumerable:!0,configurable:!0}),e.prototype.addLayer=function(t,e,n){new canvasLayerOption(this.mf_canvas,t,e,n)},Object.defineProperty(e.prototype,"x",{get:function(){return this.mf_canvas.x},set:function(t){this.mf_canvas.x=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this.mf_canvas.y},set:function(t){this.mf_canvas.y=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scale",{get:function(){return this.mf_canvas.scale},set:function(t){this.mf_canvas.scale=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rotation",{get:function(){return this.mf_canvas.rotation},set:function(t){this.mf_canvas.rotation=t},enumerable:!0,configurable:!0}),e.prototype.load=function(){MF_VFILE.getInstance().loadFile("image/png,image/jpg")},e.prototype.handleImageLoaded=function(t){this.mf_canvas.draw(this.img)},e.prototype.handleFileLoaded=function(t){var e=this;this.img=null,this.dispatchEvent(new MF_EVENT.Event("fileloaded",t)),this.img=new Image,this.img.onload=function(t){e.handleImageLoaded(t)},this.img.src=t.data},Object.defineProperty(e.prototype,"pngData",{get:function(){return this.mf_canvas.getCanvasData("image/png")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"JpgData",{get:function(){return this.mf_canvas.getCanvasData("image/jpeg",60)},enumerable:!0,configurable:!0}),e}(MF_EVENT.EventDispatcher),MF_ImageScrollControler=function(t){function e(e,n,i,a,o){void 0===a&&(a=!0),void 0===o&&(o=1);var r=t.call(this,e,n*o,i*o)||this;r.mf_canvas.setStyle("transform-origin","0 0"),r.mf_canvas.setStyle("-webkit-transform-origin","0 0"),r.mf_canvas.setStyle("-o-transform-origin","0 0"),r.mf_canvas.setStyle("-moz-transform-origin","0 0");var s=1/o;return r.mf_canvas.setStyle("transform","scale("+s+","+s+")"),r.mf_canvas.setStyle("-webkit-transform","scale("+s+","+s+")"),r.mf_canvas.setStyle("-o-transform","scale("+s+","+s+")"),r.mf_canvas.setStyle("-moz-transform","scale("+s+","+s+")"),a?(r.fc=new MF_FACETOUCH(r.box),r.fc.addEventListener("tapmove",function(t){r.handleMove(t.data)}),r.fc.addEventListener("taprotate",function(t){r.handleRotate(t.data)}),r):r}return __extends(e,t),e.prototype.handleMove=function(t){this.x-=t.offsetx,this.y-=t.offsety},e.prototype.handleRotate=function(t){this.scale+=t.scale,this.rotation+=t.angle},e}(MF_ImageScroller),MF_Loading=function(t){function e(e){var n=t.call(this)||this;return n._s=n,n.list=[],n.suclist=[],n.set=null,n.timers=30,n.length=null,n.errorCount=3,n.isLoad=function(t){for(var e=0;e<this.list.length;e++)if(t&&this.list[e].e==t)return this.list[e];return!1},n.parameter=e,n.srcNames=n.parameter.srcNames?n.parameter.srcNames:"alts",n.loadUp="function"==typeof n.parameter.LDup?n.parameter.LDup:null,n.callback="function"==typeof n.parameter.LDsuccess?n.parameter.LDsuccess:null,n.parameter.LDpage&&n.getDomList(document),n.parameter.LDdom&&n.addLoadObject(e.LDdom),n.upDate(0),n}return __extends(e,t),e.prototype.setDomList=function(t,e){for(var n=[],i=0;i<t.length;i++){var a=t[i].getAttribute(this.srcNames);a&&n.push(this.addLDstack({type:e,src:a,e:t[i]}))}return n},e.prototype.setAddList=function(t){for(var e=[],n=0;n<t.length;n++)e.push(this.addLDstack(t[n]));return e},e.prototype.getDomList=function(t){var e=t.getElementsByTagName("img"),n=t.getElementsByTagName("video"),i=t.getElementsByTagName("audio"),a=this.setDomList(e,"img"),o=this.setDomList(n,"video"),r=this.setDomList(i,"audio");return a.concat(o,r)},e.prototype.getJqList=function(t){var e=t.find("img"),n=t.find("video"),i=t.find("audio"),a=this.setDomList(e,"img"),o=this.setDomList(n,"video"),r=this.setDomList(i,"audio");return a.concat(o,r)},e.prototype.addLoadObject=function(t){if(MF_display_Judger.isDom(t)){if(!MF_display_Judger.isLdDom(t))return this.getDomList(t);var e=MF_display_Judger.getDomType(t);if("img"==e||"video"==e||"audio"==e)return this.setDomList([t],e)}else{if(MF_display_Judger.isJQ(t)){var e=MF_display_Judger.getDomType(t[0]);return"img"==e||"video"==e||"audio"==e?this.setDomList(t,e):this.getJqList(t);
}if("object"==typeof t){if(t.src&&t.type)return[this.addLDstack(t)];if("function"==typeof t.sort)return this.setAddList(t)}}},e.prototype.init=function(){for(var t=this,e=0;e<t.list.length;e++)!function(){var n=this,i=t.list[e];i.status=0,i.count=0,"img"==i.type?(i.e||(i.e=new Image),i.e.onload=function(){i.status=1,t.removeLD(i)}):"audio"!=i.type&&"video"!=i.type||(i.e||("audio"==i.type?i.e=document.createElement("audio"):i.e=document.createElement("video")),MF_display_Judger.isAndroid&&"video"==i.type||i.e.addEventListener("canplaythrough",function(t){i.status=1,n.removeLD(i)})),i.load=function(){i.count++,i.e.src=i.src,"video"!=i.type&&"audio"!=i.type||i.e.load()},i.e.onerror=function(){i.count<this.errorCount?(i.status=2,i.load()):(i.status=3,t.removeLD(i))}}()},e.prototype.upDate=function(t){this.loadUp&&this.loadUp(t),this.loadingpercent=t,this.dispatchEvent(new MF_EVENT.Event("update",t))},e.prototype.start=function(){this.init(),this.length=this.getLength(),this.loads();var t=0,e=this,n=function(){var n=parseInt(e.suclist.length/e.length*100);100>=n&&(e.parameter.LDtween?t++:t=n,e.upDate(t),100==t&&(clearInterval(e.set),e.callback&&e.callback(),e.dispatchEvent(new MF_EVENT.Event("complete",t))))};this.set=setInterval(n,this.timers)},e.prototype.add=function(t){return t?this.addLoadObject(t):void 0},e.prototype.addLDstack=function(t){var e=this.isLoad(t.e);if(e)return e;var n=this.list.push(t);return this.list[n-1]},e.prototype.addImgSheet=function(t){for(var e=[],n=t.mask||"",i=t.start;i<=t.length;i+=t.step){var a=n+i;a=a.substr(a.length-n.length),e.push({type:"img",src:t.imgPrefix+a+"."+t.imgType})}return this.setAddList(e)},e.prototype.loads=function(){for(var t=0;t<this.list.length;t++)this.list[t].load(),MF_display_Judger.isAndroid&&"video"==this.list[t].type&&(this.list[t].status=1,this.removeLD(this.list[t]),t--)},e.prototype.getLength=function(){return this.list.length},e.prototype.removeLD=function(t){for(var e=0;e<this.list.length;){if(this.list[e]==t){this.suclist.push(t),this.list.splice(e,1);break}e++}},e}(MF_EVENT.EventDispatcher),MF_DoAjax=function(_super){function MF_DoAjax(){var t=null!==_super&&_super.apply(this,arguments)||this;return t.defaultsOpts={type:"POST",async:!0,url:"",dataStringify:!1,data:null,dataType:"json",successDecode:!1,success:function(){},error:function(){alert("网络不给力，再试下吧！")},complete:function(){}},t}return __extends(MF_DoAjax,_super),MF_DoAjax.prototype.initDefaultsOpts=function(t){this.defaultsOpts=MF_UTILS.catact(this.defaultsOpts,t)},MF_DoAjax.prototype.DoAjax=function(t,e,n){var i=this;if(void 0===n&&(n=null),e=MF_UTILS.catact(this.defaultsOpts,e),e.data&&1==e.dataStringify&&(e.data=JSON.stringify(e.data)),"jsonp"==e.dataType){var a=document.createElement("script"),o=e.url,r=e.jsonp&&""!=e.jsonp?e.jsonp:"jsonpCallback",s=e.data||{};s=function(t){var e="";for(var n in t)e+=(e.length>0?"&":"")+n+"="+t[n];return e}(s),o+=-1===o.indexOf("?")?"?jsonp="+r+(s.length>0?"&"+s:""):"&jsonp="+r+(s.length>0?"&"+s:""),a.src=o,a.type="text/javascript",document.body.appendChild(a)}else this.ajax({type:e.type,async:e.async,url:e.url,data:e.data,dataType:e.dataType,success:function(e,n){i.handleSucc(e,n,t)},error:e.error,complete:e.complete})},MF_DoAjax.prototype.ajax=function(t){var e=t.data||"",n=t.async;e=function(t){var e="";for(var n in t)e+=(e.length>0?"&":"")+n+"="+t[n];return e}(e);var i=new XMLHttpRequest;i.open(t.type,t.url,n),i.setRequestHeader("Content-type","application/x-www-form-urlencoded"),i.onreadystatechange=function(){var e=i;if(4==e.readyState){if(200==e.status){var n=e.responseText,a="";switch(t.dataType){case"text":a=n;break;case"json":a=JSON.parse(n);break;default:a=JSON.parse(n)}t.success(t,a)}else t.error(e);t.complete()}},i.send(e)},MF_DoAjax.prototype.handleSucc=function(opts,d,typename){var e=new MF_EVENT.Event("mf_dataloaded");opts.successDecode&&d.Data&&""!=d.Data&&(d.Data=eval("["+MF_UTILS.html_decode(d.Data)+"]")[0]),e.data={data:d,tname:typename},this.dispatchEvent(e)},MF_DoAjax}(MF_EVENT.EventDispatcher),MF_JsonpManager=function(){function t(){this.jsonpfuncstions={}}return t}(),MF_NET=function(){function t(){}return t.reg=function(e,n){t.appUrlConfig[e]=n,t.GET_IN()[e]=t.appUrlConfig[e]},t.GET_IN=function(){return t._instance||(t._instance=new t),t._instance},t.appUrlConfig={},t}(),MF_PackInterface=function(t){function e(e){var n=t.call(this)||this;return n.ajaxer=new MF_DoAjax,n.EVENT_OBJ=e||MF_NET.GET_IN(),n.init(),n}return __extends(e,t),e.prototype.init=function(){var t=this;this.ajaxer.addEventListener("mf_dataloaded",function(e){t.handleLoaded(e)})},e.prototype.handleLoaded=function(t){this.runEvent(t.data.tname,t.data.data)},e.prototype.callInterface=function(t,e){this.EVENT_OBJ[t].url&&this.EVENT_OBJ[t].url.length>0?(this.EVENT_OBJ[t].data=e||{},this.ajaxer.DoAjax(t,this.EVENT_OBJ[t])):this.runEvent(t,e||{})},e.prototype.runEvent=function(t,e){this.dispatchEvent(new MF_EVENT.Event(t,e))},e.prototype.initDefaultsOpts=function(t){this.ajaxer.initDefaultsOpts(t)},e}(MF_EVENT.EventDispatcher),MF_DEVICECENTER=function(){function t(){}return t.check=function(){var e=navigator.userAgent.toLowerCase();e.match(/ipad/)?console.log("this is ipad"):e.match(/iphone/)?console.log("this is iphone"):e.match(/android/)?console.log("this is android"):e.match(/windows phone/)||e.match(/windows mobile/)?(t.TOUCH_START="mousedown",t.TOUCH_MOVE="mousemove",t.TOUCH_END="mouseup"):(t.TOUCH_START="mousedown",t.TOUCH_MOVE="mousemove",t.TOUCH_END="mouseup"),t.isChecked=!0},Object.defineProperty(t,"TOUCH_START",{get:function(){return t.isChecked||t.check(),t._TOUCH_START},set:function(e){t._TOUCH_START=e},enumerable:!0,configurable:!0}),Object.defineProperty(t,"TOUCH_MOVE",{get:function(){return t.isChecked||t.check(),t._TOUCH_MOVE},set:function(e){t._TOUCH_MOVE=e},enumerable:!0,configurable:!0}),Object.defineProperty(t,"TOUCH_END",{get:function(){return t.isChecked||t.check(),t._TOUCH_END},set:function(e){t._TOUCH_END=e},enumerable:!0,configurable:!0}),t._TOUCH_START="touchstart",t._TOUCH_MOVE="touchmove",t._TOUCH_END="touchend",t._DEVICE_TYPE="mobile",t.isChecked=!1,t}(),MF_FACETOUCH=function(t){function e(e){var n=t.call(this)||this;return n.element=null,n.isTouch=!1,n.touchpoints=new Array,n.name="shin",n.initdis=0,n.initrotation=0,n.pointsnumber=0,n.lastdis=0,n.lastrotation=0,n.element=document.getElementById(e)||e||document.body,n.initEvent(),n}return __extends(e,t),e.prototype.initEvent=function(){var t=this;this.element.addEventListener(MF_DEVICECENTER.TOUCH_START,function(e){t.handleTouchBegin(e)}),this.element.addEventListener(MF_DEVICECENTER.TOUCH_MOVE,function(e){t.handleTouchMove(e)}),this.element.addEventListener(MF_DEVICECENTER.TOUCH_END,function(e){t.handleTouchEnd(e)});var e=this.element;document.addEventListener(MF_DEVICECENTER.TOUCH_END,function(){e.removeEventListener(MF_DEVICECENTER.TOUCH_MOVE,this.handleTouchMove)})},e.prototype.handleTouchBegin=function(t){t.preventDefault(),this.isTouch=!0;var e="";for(var n in t)e+=n+"="+t[n]+"\n";if(t.targetTouches){var i=t.targetTouches.length;switch(this.pointsnumber++,i){case 1:this.lastp=this.touchpoints=[new MF_Point(t.targetTouches[0].pageX,t.targetTouches[0].pageY)];break;case 2:this.touchpoints=[new MF_Point(t.targetTouches[0].pageX,t.targetTouches[0].pageY),new MF_Point(t.targetTouches[1].pageX,t.targetTouches[1].pageY)],this.initdis=this.caculatepointsDistance(this.touchpoints[0],this.touchpoints[1]).offsetdistance,this.initrotation=this.caculatepointsDistance(this.touchpoints[0],this.touchpoints[1]).angle/Math.PI*180}this.element.addEventListener("touchmove",this.handleTouchMove)}else this.touchpoints=this.lastp=[new MF_Point(t.pageX,t.pageY)],this.element.addEventListener(MF_DEVICECENTER.TOUCH_MOVE,this.handleTouchMove)},e.prototype.handleTouchMove=function(t){if(this.isTouch){var e;if(t.targetTouches){var n=t.targetTouches.length;switch(n){case 1:e=[new MF_Point(t.targetTouches[0].pageX,t.targetTouches[0].pageY)],this.handleTouchesByOnePoint(e,this.touchpoints);break;case 2:e=[new MF_Point(t.targetTouches[0].pageX,t.targetTouches[0].pageY),new MF_Point(t.targetTouches[1].pageX,t.targetTouches[1].pageY)],this.handleTouchsByMultiPoints(e,this.touchpoints)}}else e=[new MF_Point(t.pageX,t.pageY)],this.handleTouchesByOnePoint(e,this.touchpoints)}this.touchpoints=e},e.prototype.caculatepointsDistance=function(t,e){var n,i=new MF_Point,a=e.x-t.x,o=e.y-t.y,r=Math.sqrt(a*a+o*o);return n=Math.atan2(o,a),i.offsetx=a,i.offsety=o,i.offsetdistance=r,i.angle=n,i},e.prototype.handleTouchEnd=function(t){this.isTouch=!1,this.pointsnumber=0,this.initdis=this.lastdis,this.initrotation=this.lastrotation,this.dispatchEvent(new MF_EVENT.Event("tapend",this.lastp)),this.element.removeEventListener(MF_DEVICECENTER.TOUCH_MOVE,this.handleTouchMove)},e.prototype.handleTouchesByOnePoint=function(t,e){var n=this.caculatepointsDistance(t[0],e[0]);this.lastp=n,this.dispatchEvent(new MF_EVENT.Event("tapmove",n))},e.prototype.handleTouchsByMultiPoints=function(t,e){var n=this.caculatepointsDistance(t[0],t[1]),i=this.caculatepointsDistance(e[0],e[1]),a=i.offsetdistance-n.offsetdistance,o=i.angle-n.angle,r=-a/this.initdis/2,s=new MF_Point;s.angle=-o/Math.PI*180,s.scale=r,this.dispatchEvent(new MF_EVENT.Event("taprotate",s))},e}(MF_EVENT.EventDispatcher),MF_TagManager=function(){function t(){}return t.start=function(){window.onhashchange=function(e){t.handleHash()};var e=window.location.hash.replace(/#/,""),n=t.tags;if(e in n){var i=n[e].funname;i(n[e].a)}},t.handleHash=function(){var e=window.location.hash.replace(/#/,"");e in t.tags&&t.tags[e].funname(t.tags[e].a)},t.addTag=function(e,n){for(var i=[],a=2;a<arguments.length;a++)i[a-2]=arguments[a];t.tags[e]={funname:n,a:i}},t.removeTag=function(e){var n=t.tags;e in n&&delete n[e]},t.configTag=function(e,n){for(var i=[],a=2;a<arguments.length;a++)i[a-2]=arguments[a];t.addTag(e,n,i)},t.tags={},t}();